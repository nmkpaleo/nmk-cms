{% load i18n allauth account form_widgets %}
{% if not SOCIALACCOUNT_ONLY %}
    {% url 'account_login' as login_url %}
    <form method="post"
          action="{{ login_url }}"
          class="w3-container w3-padding-16 w3-animate-opacity"
          aria-labelledby="login-form-heading">
        {% csrf_token %}
        <h2 id="login-form-heading" class="w3-large w3-text-brown w3-margin-bottom">
            {% trans "Use your NMK credentials" %}
        </h2>
        {% if form.non_field_errors %}
            <div class="w3-panel w3-border w3-border-red w3-pale-red" role="alert" aria-live="polite">
                <p class="w3-text-red w3-margin-top w3-margin-bottom">{{ form.non_field_errors|join:" " }}</p>
            </div>
        {% endif %}
        {% for hidden in form.hidden_fields %}
            {{ hidden }}
        {% endfor %}
        {% for field in form.visible_fields %}
            <div class="w3-section">
                <label for="{{ field.id_for_label }}" class="w3-text-dark-grey w3-small w3-uppercase">
                    {{ field.label }}
                </label>
                {% render_form_field field css_class="w3-input w3-border w3-round-large" placeholder=field.label %}
                {% if field.errors %}
                    <div class="w3-text-red w3-small" role="alert">
                        {{ field.errors|join:" " }}
                    </div>
                {% endif %}
                {% if field.help_text %}
                    <p class="w3-small w3-text-gray">{{ field.help_text }}</p>
                {% endif %}
            </div>
        {% endfor %}
        {{ redirect_field }}
        <button type="submit"
                class="w3-button w3-brown w3-round-xlarge w3-block w3-padding-large w3-margin-top">
            <span class="fa-solid fa-right-to-bracket" aria-hidden="true"></span>
            <span class="w3-margin-left">{% trans "Log In" %}</span>
        </button>
    </form>
{% endif %}

{% if LOGIN_BY_CODE_ENABLED or PASSKEY_LOGIN_ENABLED %}
    <div class="w3-section">
        {% element button_group vertical=True %}
            {% if PASSKEY_LOGIN_ENABLED %}
                {% element button type="submit" form="mfa_login" id="passkey_login" class="w3-button w3-border w3-round-large w3-white w3-block" tags="prominent,login,outline,primary" %}
                    {% trans "Sign in with a passkey" %}
                {% endelement %}
            {% endif %}
            {% if LOGIN_BY_CODE_ENABLED %}
                {% element button href=request_login_code_url class="w3-button w3-border w3-round-large w3-white w3-block" tags="prominent,login,outline,primary" %}
                    {% trans "Mail me a sign-in code" %}
                {% endelement %}
            {% endif %}
        {% endelement %}
    </div>
{% endif %}

{% if SOCIALACCOUNT_ENABLED %}
    {% include "socialaccount/snippets/login.html" with page_layout="entrance" %}
{% endif %}

{% if not SOCIALACCOUNT_ONLY %}
    {% setvar link %}
        <a href="{{ signup_url }}" class="w3-text-brown w3-hover-text-black">
    {% endsetvar %}
    {% setvar end_link %}
        </a>
    {% endsetvar %}
    <p class="w3-small w3-center w3-margin-top">
        {% blocktranslate %}Don't have an account? {{ link }}Sign up{{ end_link }}.{% endblocktranslate %}
    </p>
{% endif %}
