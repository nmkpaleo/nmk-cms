{% extends "base_generic.html" %}
{% load i18n %}

{% block content %}
<main class="w3-container w3-padding-16">
  <header class="w3-margin-bottom">
    <h1 class="w3-xxlarge">
      <span class="fa fa-file-import" aria-hidden="true"></span>
      <span class="w3-margin-left">{% trans "Manual QC Import" %}</span>
    </h1>
  </header>
  <section class="w3-card w3-round-large w3-padding">
    <form method="post" enctype="multipart/form-data" class="w3-container" novalidate>
      {% csrf_token %}
      {% if form.non_field_errors %}
        <div class="w3-panel w3-red w3-round" role="alert">
          <h2 class="w3-large">{% trans "Please correct the errors below" %}</h2>
          <ul class="w3-ul">
            {% for error in form.non_field_errors %}
              <li>{{ error }}</li>
            {% endfor %}
          </ul>
        </div>
      {% endif %}
      {% for field in form %}
        <div class="w3-section">
          <label class="w3-text-theme" for="{{ field.id_for_label }}">{{ field.label }}</label>
          {{ field }}
          {% if field.help_text %}
            <p class="w3-small w3-text-gray">{{ field.help_text }}</p>
          {% endif %}
          {% if field.errors %}
            <ul class="w3-ul w3-small w3-text-red">
              {% for error in field.errors %}
                <li>{{ error }}</li>
              {% endfor %}
            </ul>
          {% endif %}
        </div>
      {% endfor %}
      <div class="w3-section">
        <button type="submit" class="w3-button w3-blue w3-round-large">
          <span class="fa fa-upload" aria-hidden="true"></span>
          <span class="w3-margin-left">{% trans "Import data" %}</span>
        </button>
      </div>
    </form>
  </section>
  <section class="w3-margin-top">
    {% if result %}
      <article class="w3-card w3-padding w3-round-large" aria-live="polite">
        <h2 class="w3-xlarge">
          <span class="fa fa-chart-bar" aria-hidden="true"></span>
          <span class="w3-margin-left">{% trans "Import summary" %}</span>
        </h2>
        <p>
          {% blocktrans with total=result.total_rows success=result.success_count errors=result.error_count %}
            Processed {{ total }} rows: {{ success }} succeeded and {{ errors }} failed.
          {% endblocktrans %}
        </p>
        {% if result.created_count %}
          <p>
            {% blocktrans with created=result.created_count %}
              Created {{ created }} accession records.
            {% endblocktrans %}
          </p>
        {% endif %}
        {% if result.error_count %}
          <p>
            <a class="w3-button w3-red w3-round-large" href="?download=errors">
              <span class="fa fa-download" aria-hidden="true"></span>
              <span class="w3-margin-left">{% trans "Download error report" %}</span>
            </a>
          </p>
          <ul class="w3-ul w3-border w3-round">
            {% for failure in result.failures %}
              <li>
                <strong>
                  {% blocktrans with row=failure.row_number %}
                    Row {{ row }}
                  {% endblocktrans %}
                </strong>
                {% if failure.identifier %}
                  â€“ {{ failure.identifier }}
                {% endif %}
                <br />
                <span>{{ failure.message }}</span>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="w3-text-green">
            <span class="fa fa-check-circle" aria-hidden="true"></span>
            <span class="w3-margin-left">{% trans "No errors were encountered during the import." %}</span>
          </p>
        {% endif %}
      </article>
    {% endif %}
  </section>
</main>
{% endblock %}
