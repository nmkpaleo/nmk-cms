{% extends "base_generic.html" %}
{% load user_tags %}

{% block content %}
<div class="w3-container w3-margin-top">
  <h2>Preparation Records</h2>

  {% if user.is_superuser or user|has_group:"Collection Managers" or user|has_group:"Curators" or user|has_group:"Preparators" %}
    <a href="{% url 'preparation_create' %}" class="w3-button w3-green w3-margin-bottom">New Preparation</a>
  {% endif %}

  <button onclick="toggleAccordion('prepFilterPanel')" class="w3-button w3-block w3-light-grey w3-left-align">
    üîç Show/Hide Filters
  </button>

  <div id="prepFilterPanel" class="w3-hide w3-animate-opacity w3-padding w3-light-grey w3-round-large w3-margin-top">
    <form method="get">
<!-- Row 1: quarters -->
<div class="w3-row-padding">
  <div class="w3-quarter">
    <label>Specimen</label>
    {{ filter.form.accession_label }}
  </div>
  <div class="w3-quarter">
    <label>Status</label>
    {{ filter.form.status }}
  </div>
  <div class="w3-quarter">
    <label>Approval Status</label>
    {{ filter.form.approval_status }}
  </div>
  <div class="w3-quarter">
    <label>Preparator</label>
    {{ filter.form.preparator }}
  </div>
</div>

<!-- Row 2: halves -->
<div class="w3-row-padding">
  <div class="w3-half">
    <label>Started Between</label>
    {{ filter.form.started_on }}
  </div>
  <div class="w3-half">
    <label>Completed Between</label>
    {{ filter.form.completed_on }}
  </div>
</div>
      <div class="w3-container w3-padding-16">
        <button type="submit" class="w3-button w3-blue w3-margin-right">Apply Filters</button>
        <a href="{% url 'preparation_list' %}" class="w3-button w3-gray">Clear</a>
      </div>
    </form>
  </div>
  <div class="table-container">
    <table class="table">
    <thead>
        <tr>
            <th>Specimen</th>
            <th>Preparator</th>
            <th>Status</th>
            <th>Curator</th>
            <th>Approval Status</th>
        </tr>
    </thead>
    <tbody>
        {% for preparation in preparations %}
        <tr>
            <td><a href="{% url 'preparation_detail' preparation.id %}">{{ preparation.accession_row }}</a></td>
            <td>{{ preparation.preparator }}</td>
            <td>{{ preparation.status }}</td>
            <td>{{ preparation.curator|default:"N/A" }}</td>
            <td>{{ preparation.approval_status }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
  </div>
</div>
{% endblock %}

{% block script %}
  <script>
    function toggleAccordion(id) {
      var panel = document.getElementById(id);
      if (panel.classList.contains("w3-show")) {
        panel.classList.remove("w3-show");
        panel.classList.add("w3-hide");
      } else {
        panel.classList.remove("w3-hide");
        panel.classList.add("w3-show");
      }
    }
  </script>  
{% endblock %}
