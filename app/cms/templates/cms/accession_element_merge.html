{% load i18n %}

<div id="accession-element-merge" class="w3-margin-top">
  <div
    id="accession-element-merge-panel"
    class="w3-card w3-round w3-white w3-padding {% if not merge_open %}w3-hide{% endif %}"
    data-default-open="{{ merge_open|yesno:'true,false' }}"
    role="region"
    aria-hidden="{{ merge_open|yesno:'false,true' }}"
    aria-labelledby="accession-element-merge-heading"
  >
    <div class="w3-row w3-padding-small">
      <div class="w3-col s12 m8">
        <h3 id="accession-element-merge-heading" class="w3-margin-top">
          <i class="fa-solid fa-object-group" aria-hidden="true"></i>
          <span class="w3-margin-left">{% trans "Merge elements" %}</span>
        </h3>
        <p class="w3-text-gray">
          {% trans "Pick one target and at least one source element from this specimen, then continue to review the field selections." %}
        </p>
      </div>
      <div class="w3-col s12 m4 w3-right-align">
        <a href="#accession-element-merge" class="w3-button w3-light-grey w3-round">
          <i class="fa-solid fa-circle-question" aria-hidden="true"></i>
          <span class="w3-hide-small w3-margin-left">{% trans "Need help?" %}</span>
        </a>
      </div>
    </div>

    <form
      method="post"
      action="{{ merge_action|default:request.get_full_path }}"
      class="w3-margin-top"
      aria-describedby="accession-element-merge-heading"
      data-controller="accession-element-merge-form"
      data-merge-action="{{ merge_action|default:'' }}"
    >
      {% csrf_token %}
      <input type="hidden" name="stage" value="prepare" />

      {% if element_merge_errors %}
        <ul class="w3-text-red w3-small" role="alert">
          {% for error in element_merge_errors %}
            <li>{{ error }}</li>
          {% endfor %}
        </ul>
      {% endif %}

      <div class="w3-responsive">
        <table class="w3-table-all w3-hoverable w3-small" role="grid" aria-label="{% trans 'Element merge selection' %}">
          <thead>
            <tr>
              <th scope="col">{% trans "Target" %}</th>
              <th scope="col">{% trans "Source" %}</th>
              <th scope="col">{% trans "Element" %}</th>
              <th scope="col">{% trans "Side" %}</th>
              <th scope="col">{% trans "Description" %}</th>
            </tr>
          </thead>
          <tbody>
            {% for specimen in natureofspecimens %}
              <tr>
                <td>
                  <label class="w3-small" for="id_element_target_{{ specimen.pk }}">
                    <input
                      class="w3-radio"
                      type="radio"
                      name="target"
                      id="id_element_target_{{ specimen.pk }}"
                      value="{{ specimen.pk }}"
                      aria-label="{% blocktrans with name=specimen.element %}Select {{ name }} as target{% endblocktrans %}"
                      required
                    />
                    <span class="w3-margin-left">{% trans "Target" %}</span>
                  </label>
                </td>
                <td>
                  <label class="w3-small" for="id_element_source_{{ specimen.pk }}">
                    <input
                      class="w3-check"
                      type="checkbox"
                      name="source_ids"
                      id="id_element_source_{{ specimen.pk }}"
                      value="{{ specimen.pk }}"
                      data-merge-source
                      aria-label="{% blocktrans with name=specimen.element %}Merge {{ name }} as source{% endblocktrans %}"
                    />
                    <span class="w3-margin-left">{% trans "Source" %}</span>
                  </label>
                </td>
                <td>{{ specimen.element|default:"—" }}</td>
                <td>{{ specimen.side|default:"—" }}</td>
                <td>{{ specimen.verbatim_element|default:"—" }}</td>
              </tr>
            {% empty %}
              <tr>
                <td colspan="5" class="w3-center w3-text-gray">{% trans "No elements available to merge." %}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <footer class="w3-margin-top">
        <button class="w3-button w3-blue w3-round w3-margin-right" type="submit">
          <i class="fa-solid fa-arrow-right" aria-hidden="true"></i>
          <span class="w3-margin-left">{% trans "Continue" %}</span>
        </button>
        <span class="w3-text-red w3-small" role="status" aria-live="polite" data-merge-status hidden></span>
      </footer>
    </form>
  </div>
</div>
